<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Paypal Integration</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
</head>

<body>
<div class="container">
    <h1 class="text-center mt-5">Paypal Payment Integration</h1>
    <form id="paymentForm" class="mt-5 card p-3">
        <div class="mb-3">
            <label for="subid" class="form-label">Subscription ID</label>
            <input id="subid" type="number" class="form-control"
                   name="subid" required>
        </div>
        <div class="mb-3">
            <label for="amount" class="form-label">Amount</label>
            <input id="amount" type="text" class="form-control"
                   name="amount" placeholder="10.00" required>
        </div>
        <div class="mb-3">
            <label for="currency" class="form-label">Currency</label>
            <select class="form-control" id="currency" name="currency">
                <option value="USD" selected>USD</option>
                <option value="EUR">EUR</option>
                <option value="GBP">GBP</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <input id="description" type="text" class="form-control"
                   name="description" required>
        </div>
        <div class="d-flex justify-content-center">
            <button type="submit" class="btn btn-primary">
                Pay with Paypal
            </button>
        </div>
    </form>
</div>

<script>
    document.getElementById("paymentForm").addEventListener("submit", async function (event) {
        event.preventDefault();

        const paymentData = {
            subid: document.getElementById("subid").value,
            amount: document.getElementById("amount").value,
            currency: document.getElementById("currency").value,
            description: document.getElementById("description").value
        };

        try {
            const response = await fetch("http://localhost:8081/payment/create", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(paymentData)
            });

            if (response.ok) {
                const approvalUrl = await response.text();
                window.location.href = approvalUrl; // Redirect to PayPal
            } else {
                alert("Payment initiation failed: " + await response.text());
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Something went wrong. Please try again.");
        }
    });
</script>
</body>
</html>
